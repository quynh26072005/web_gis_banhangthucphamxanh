{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - Clean Food GIS{% endblock %}

{% block extra_css %}
<style>
    .zones-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
        border-radius: 0 0 20px 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .zones-header h1 {
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .stats-badge {
        background: rgba(255,255,255,0.2);
        backdrop-filter: blur(10px);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        display: inline-block;
        font-size: 0.9rem;
    }
    
    .map-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        padding: 1.5rem;
        margin-bottom: 2rem;
        transition: transform 0.3s ease;
    }
    
    .map-container:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.15);
    }
    
    .zones-list {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        padding: 1.5rem;
    }
    
    .zone-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .zone-card:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .zone-name {
        font-size: 1.2rem;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 0.5rem;
    }
    
    .zone-info {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 0.5rem;
    }
    
    .info-item {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        font-size: 0.9rem;
        color: #4a5568;
    }
    
    .info-item i {
        color: #667eea;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.3rem 0.8rem;
        border-radius: 50px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    .status-active {
        background: #c6f6d5;
        color: #22543d;
    }
    
    .status-inactive {
        background: #fed7d7;
        color: #742a2a;
    }
    
    .back-btn {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
        padding: 0.5rem 1.5rem;
        border-radius: 25px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        font-weight: 600;
    }
    
    .back-btn:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<div class="zones-header">
    <div class="container">
        <a href="{% url 'gis_tools:home' %}" class="back-btn">
            <i class="fas fa-arrow-left"></i> Quay lại
        </a>
        <h1 class="mt-3"><i class="fas fa-map-marked-alt"></i> {{ title }}</h1>
        <p class="lead mb-3">Quản lý và theo dõi các khu vực giao hàng trên bản đồ</p>
        <span class="stats-badge">
            <i class="fas fa-layer-group"></i> {{ zones_count }} khu vực đang hoạt động
        </span>
    </div>
</div>

<div class="container">
    <div class="row">
        <!-- Bản đồ -->
        <div class="col-lg-8 mb-4">
            <div class="map-container">
                <h3 class="mb-3">
                    <i class="fas fa-globe"></i> Bản đồ Khu vực
                </h3>
                {% if map_html %}
                    {{ map_html|safe }}
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Chưa có dữ liệu khu vực giao hàng
                    </div>
                {% endif %}
            </div>
            
            <div class="alert alert-info" style="border-radius: 12px; border-left: 4px solid #3182ce;">
                <h5><i class="fas fa-lightbulb"></i> Hướng dẫn:</h5>
                <ul class="mb-0">
                    <li>Click vào các vùng màu trên bản đồ để xem thông tin chi tiết</li>
                    <li>Sử dụng nút zoom để phóng to/thu nhỏ bản đồ</li>
                    <li>Các vùng màu khác nhau đại diện cho các khu vực giao hàng khác nhau</li>
                </ul>
            </div>
        </div>
        
        <!-- Danh sách khu vực -->
        <div class="col-lg-4">
            <div class="zones-list">
                <h3 class="mb-3">
                    <i class="fas fa-list"></i> Danh sách Khu vực
                </h3>
                
                {% if zones_count > 0 %}
                    <div id="zones-container">
                        <p class="text-muted text-center">
                            <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                        </p>
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> Chưa có khu vực giao hàng nào
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Load delivery zones via API
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/gis-tools/api/delivery-zones-geojson/')
            .then(response => response.json())
            .then(data => {
                displayZonesList(data);
            })
            .catch(error => {
                console.error('Error loading zones:', error);
                document.getElementById('zones-container').innerHTML = 
                    '<div class="alert alert-danger">Không thể tải dữ liệu khu vực</div>';
            });
    });
    
    function displayZonesList(geojson) {
        const container = document.getElementById('zones-container');
        if (!geojson.features || geojson.features.length === 0) {
            container.innerHTML = '<div class="alert alert-info">Không có khu vực nào</div>';
            return;
        }
        
        let html = '';
        geojson.features.forEach((feature, index) => {
            const props = feature.properties;
            html += `
                <div class="zone-card" onclick="highlightZone(${index})">
                    <div class="zone-name">
                        <i class="fas fa-map-pin"></i> ${props.name}
                    </div>
                    <div class="zone-info">
                        <div class="info-item">
                            <i class="fas fa-shipping-fast"></i>
                            ${props.delivery_fee.toLocaleString('vi-VN')} ₫
                        </div>
                        <div class="info-item">
                            <i class="fas fa-clock"></i>
                            ${props.delivery_time}
                        </div>
                    </div>
                    <div class="mt-2">
                        <span class="status-badge ${props.is_active ? 'status-active' : 'status-inactive'}">
                            ${props.is_active ? 'Đang hoạt động' : 'Tạm ngưng'}
                        </span>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    function highlightZone(index) {
        // This could be enhanced to highlight the zone on the map
        console.log('Zone clicked:', index);
    }
</script>
{% endblock %}
